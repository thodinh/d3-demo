"use strict";function filterConvert(a,b){if(b){for(var c in a)a[c].filter&&b&&b[c]&&(a[c].filter.term=b[c]),a[c].filters&&b&&(b[c]||0==b[c])&&(a[c].filters[0].term=b[c]);return a}var b={};for(var c in a)a[c].filter&&a[c].filter.term&&(b[c]=a[c].filter.term),a[c].filters&&(a[c].filters[0].term||0==a[c].filters[0].term)&&(b[c]=a[c].filters[0].term);return b}angular.module("superstockApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ui.grid","agGrid","ui.grid.pinning","firebase.auth","firebase.ref","ui.slider","btorfs.multiselect","uiSwitch"]),$(document).on("click",".ag-row",function(){var a=$(this),b=a.prop("class").indexOf("click-row");$(".ag-row").removeClass("click-row"),b>-1?a.removeClass("click-row"):a.addClass("click-row")}),angular.module("superstockApp").factory("draw",["$firebaseArray",function(a){var b=function(b,c,d,e,f){var g=a(b),h=[],i=!0;g.$watch(function(a){if(0!=i&&0!=g.length){var b=g[g.length-1],e={};c.idLabel&&(e[c.idLabel]=b.$id);var f=b.$value.split("|");for(var j in c.labelList)c.labelList[j].format.indexOf("percent")>-1?(e[c.labelList[j].fieldName]=Math.ceil(1e4*f[j])/100,isNaN(e[c.labelList[j].fieldName])&&(e[c.labelList[j].fieldName]="")):c.labelList[j].format.indexOf("bigNum")>-1||c.labelList[j].format.indexOf("number")>-1?(e[c.labelList[j].fieldName]=parseFloat(f[j]),isNaN(e[c.labelList[j].fieldName])&&(e[c.labelList[j].fieldName]="")):e[c.labelList[j].fieldName]=f[j];d(e),h.push(e)}}),g.$loaded(function(){i=!1,e(h),b.on("child_added",function(a,b){var d={};c.idLabel&&(d[c.idLabel]=a.key);var e=a.val().split("|");for(var g in c.labelList)c.labelList[g].format.indexOf("percent")>-1?(""==e[g]?d[c.labelList[g].fieldName]="":d[c.labelList[g].fieldName]=Math.ceil(1e4*e[g])/100,isNaN(d[c.labelList[g].fieldName])&&(d[c.labelList[g].fieldName]="")):c.labelList[g].format.indexOf("bigNum")>-1||c.labelList[g].format.indexOf("number")>-1?(d[c.labelList[g].fieldName]=parseFloat(e[g]),isNaN(d[c.labelList[g].fieldName])&&(d[c.labelList[g].fieldName]="")):d[c.labelList[g].fieldName]=e[g];f.added(d,a,b)}),b.on("child_changed",function(a,b){var d={};c.idLabel&&(d[c.idLabel]=a.key);var e=a.val().split("|");for(var g in c.labelList)c.labelList[g].format.indexOf("percent")>-1?(d[c.labelList[g].fieldName]=Math.ceil(1e4*e[g])/100,isNaN(d[c.labelList[g].fieldName])&&(d[c.labelList[g].fieldName]="")):c.labelList[g].format.indexOf("bigNum")>-1||c.labelList[g].format.indexOf("number")>-1?(d[c.labelList[g].fieldName]=parseFloat(e[g]),isNaN(d[c.labelList[g].fieldName])&&(d[c.labelList[g].fieldName]="")):d[c.labelList[g].fieldName]=e[g];f.changed(d,a,b)}),b.on("child_removed",function(a){f.removed(a)})})};return{drawGrid:b}}]),angular.module("superstockApp").factory("utils",["$http","$q","$rootScope",function(a,b,c){return{getCellClass:function(a,b,c){var d=a.colDef.field,e=a.value,f=[];switch(c&&""!=c&&"symbol"!=d&&f.push("ag-cell-focus-bg"),(b[d].indexOf("number")>-1||b[d].indexOf("percent")>-1||b[d].indexOf("bigNum")>-1)&&f.push("ui-cell-align-right"),a.value&&b[d].indexOf("percent")>-1&&f.push("percent"),d){case"priceChange":0>e?f.push("grid-cell-red"):f.push("grid-cell-green");break;case"EPS":1e3>e?f.push("grid-cell-red"):f.push("grid-cell-green");break;case"revenueChange":case"EPSChange":case"profitChange":0>e?f.push("grid-cell-red"):f.push("grid-cell-green");break;case"point":5>e?f.push("grid-cell-red"):e>=5&&7>e?f.push("grid-cell-green"):f.push("grid-cell-purple");break;case"roe":10>e?f.push("grid-cell-red"):f.push("grid-cell-green");break;case"fxEffect":case"cashFlow":0>e?f.push("grid-cell-red"):e>0&&f.push("grid-cell-green")}return f},getCellClassSummary:function(a,b,d){var e=a.colDef.field,f=a.value,g=["ag-cell-orange-bg"];switch(d&&""!=d&&"symbol"!=e&&g.push("ag-cell-focus-bg"),(b[e].indexOf("number")>-1||b[e].indexOf("percent")>-1||b[e].indexOf("bigNum")>-1)&&g.push("ui-cell-align-right"),a.value&&b[e].indexOf("percent")>-1&&g.push("percent"),e){case"symbol":""!=f&&(""!=a.data.signal1||""!=a.data.signal2)&&(""!=a.data.Canslim?g.push("ag-cell-purple-color"):g.push("grid-cell-green"),g.push("ag-cell-fill-bg"));break;case"industry":f>=5e9&&"main"==c.link&&(g.push("ag-cell-purple-color"),g.push("ag-cell-fill-bg"));break;case"totalValue":f>=5e9&&(g.push("ag-cell-purple-color"),g.push("ag-cell-fill-bg"));break;case"EPS":f>=3e3?(g.push("ag-cell-purple-color"),g.push("ag-cell-fill-bg")):f>1e3?g.push("grid-cell-green"):1e3>f&&g.push("grid-cell-red");break;case"newPoint":f>=7?(g.push("ag-cell-purple-color"),g.push("ag-cell-fill-bg")):f>=5?g.push("grid-cell-green"):4>=f&&g.push("grid-cell-red"),g.push("text-center");break;case"Canslim":case"pricePeak":""!=f&&(g.push("ag-cell-fill-bg"),"..Rủi ro"==f?g.push("grid-cell-red"):g.push("ag-cell-purple-color")),g.push("text-center");break;case"symbol2":""!=f&&(""!=a.data.signal1||""!=a.data.signal2)&&(""!=a.data.Canslim?g.push("ag-cell-purple-color"):g.push("grid-cell-green"),g.push("ag-cell-fill-bg")),g.push("ag-cell-green-bg"),g.push("text-center");break;case"signal1":case"signal2":""!=f&&(g.push("ag-cell-fill-bg"),g.push("ag-cell-purple-color")),g.push("ag-cell-green-bg"),g.push("text-center");break;case"sellSignal":g.push("ag-cell-red-bg"),g.push("text-center");break;case"volumeChange":f>=30&&"main"==c.link&&(g.push("ag-cell-purple-color"),g.push("ag-cell-fill-bg"))}return g},getMarketSummary:function(){var c=b.defer();return a.get("https://superstock.firebaseio.com/market_summary.json",{}).then(function(a){if(a&&a.data){var b=a.data,d={color:b.color,content:a.data.data?a.data.data:""};d.content=d.content.replace("\n","<br />"),c.resolve(d)}},function(a){c.reject(a)}),c.promise},getSellSignals:function(){var c=b.defer(),d=[];return a.get("https://superstock.firebaseio.com/sell_symbols.json",{}).then(function(a){if(a&&a.data&&a.data.data&&a&&a.data&&a.data.data){var b=a.data.data,e=b.split("|");for(var f in e){var g={sellSignal:e[f]};d.push(g)}}c.resolve(d)},function(a){c.reject(a)}),c.promise},getCompanyInformation:function(c){var d=b.defer(),e=[];return a.get("https://superstock.firebaseio.com/profile/"+c+".json",{}).then(function(a){if(a&&a.data&&a.data.data){if(a&&a.data&&a.data.data){var b=a.data.data;e=b}d.resolve(e)}},function(a){d.reject(a)}),d.promise},writeData2Worksheet:function(a,b){return new Promise(function(a,b){var c="data/template.xlsx",d=new XMLHttpRequest;d.open("GET",c,!0),d.responseType="arraybuffer",d.onload=function(b){for(var c=d.response,e=new Uint8Array(c),f=new Array,g=0;g!=e.length;++g)f[g]=String.fromCharCode(e[g]);var h=f.join(""),i=XLSX.read(h,{type:"binary",cellStyles:!0});a(i)},d.send()}).then(function(c){return new Promise(function(d,e){var f=c.Sheets[c.SheetNames[0]],g=4;for(var h in a){var i=0;for(var j in a[h]){var k=j;if("symbol2"==j&&(k+=i,i++),b[k]){var l=b[k].cell;if(l){var m=l+(g+parseInt(h)),n=f[m];if(n||(n={}),n.v=a[h][j],(b[k].format.indexOf("number")>-1||b[k].format.indexOf("bigNum")>-1)&&(n.t="n",n.z="#,###",n.v&&null!=n.v&&""!=n.v||(n.v=0),0==n.v&&delete n.z),b[k].format.indexOf("percent")>-1){n.t="s";var o=parseFloat(n.v);isNaN(o)?n.v="":(o=o.toFixed(2),n.v=o+"%")}if(""==b[k].format&&(n.t="s"),f[m]=n,"symbol2"==j&&b[j+i]){var m=b[j+i].cell+(g+parseInt(h)),n=f[m];n.v=a[h][j]}}}}}d(c)})})["catch"](function(a){return a})},generateWorksheetFile:function(a,b){function c(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!=a.length;++d)c[d]=255&a.charCodeAt(d);return b}var d={bookType:"xlsx",bookSST:!1,type:"binary",cellStyles:!0},e=XLSX.write(a,d),f=new Date,g="SuperStock"+f.getFullYear()+(f.getUTCMonth()+1)+f.getUTCDate()+".xlsx";saveAs(new Blob([c(e)],{type:""}),g),b&&b()}}}]),angular.module("superstockApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),angular.module("firebase.auth",[]).constant("SIMPLE_LOGIN_PROVIDERS",["password","facebook"]).constant("loginRedirectPath","/login").factory("auth",["$firebaseAuth",function(a){return a()}]),angular.module("firebase.ref",["firebase"]).factory("Ref",function(){return firebase.database().ref()}),angular.module("superstockApp").controller("LoginCtrl",["$scope","auth","$location",function(a,b,c){function d(a){var b=(rootRef.child("users").child(a.uid),$q.defer());return ref.set({email:email,name:e(email)},function(a){$timeout(function(){a?b.reject(a):b.resolve(ref)})}),b.promise}function e(a){return f(a.substr(0,a.indexOf("@"))||"")}function f(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function g(){c.path("/account")}function h(b){a.err=b}a.loginBtn=!0,a.logoutBtn=!0,b.$onAuthStateChanged(function(b){b&&(console.log(" logged: "+b.uid),a.logoutBtn=!0,a.loginBtn=!1,c.path("/account"))}),a.oauthLogin=function(a){b.$signInWithPopup(a).then(function(a){console.log("logged"),g()})["catch"](function(a){console.log("login error"),h(a)})},a.anonymousLogin=function(){b.$signInAnonymously().then(function(a){console.log("logged ",a.uid)})["catch"](function(a){console.log("login error ",a)})},a.passwordLogin=function(a,c){b.$signInWithEmailAndPassword(a,c).then(function(a){g(),console.log("logged")})["catch"](function(a){h(a),console.log("error: "+a)})},a.createAccount=function(c,e,f){a.err=null,e?e!==f?a.err="Passwords do not match":b.$createUserWithEmailAndPassword(c,e).then(function(a){return console.log("User "+a.uid+" created successfully"),a}).then(function(a){console.log("Logged user: ",a.uid),d(),g()})["catch"](function(a){console.error("Error: ",a)}):a.err="Please enter a password"}}]),angular.module("superstockApp").controller("AccountCtrl",["$scope","auth","currentAuth",function(a,b,c,d){function e(a){console.log("Error: ",a)}a.user={uid:c.uid,name:c.displayName,photo:c.photoURL,email:c.email},a.authInfo=c,a.changePassword=function(c,d,f){a.err=null,c&&d?d!==f?e("Passwords do not match"):b.$updatePassword(d).then(function(){console.log("Password changed")},e):e("Please enter all fields")},a.changeEmail=function(a){b.$updateEmail(a).then(function(){console.log("email changed successfully")})["catch"](function(a){console.log("Error: ",a)})},a.logout=function(){b.$signOut()},a.updateProfile=function(a,b){firebase.auth().currentUser.updateProfile({displayName:a,photoURL:b}).then(function(){console.log("updated")})["catch"](function(a){console.log("error ",a)})}}]),angular.module("superstockApp").controller("MainCtrl",["$rootScope","$scope","auth","$firebaseArray","$firebaseObject","Ref","draw","uiGridConstants","$sce","utils","currentAuth","$window","$compile","$filter","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.link="main",l.ga("send","pageview","Tổng hợp"),b.gridMainOptions={enableSorting:!0,enableFilter:!0,suppressColumnVirtualisation:!0,suppressContextMenu:!0,rowData:[],data:[],enableColResize:!0,headerHeight:50,overlayLoadingTemplate:'<span class="ag-overlay-loading-center">Đang xử lý dữ liệu...</span>',sortingOrder:["desc","asc"],onAfterFilterChanged:function(){},onCellClicked:function(a){}};var p=[{headerName:"Báo bán",field:"sellSignal",width:70,headerCellTemplate:function(a){var b="ag-header-cell-red";return'<div class="ag-header-cell '+b+' ag-header-cell-sortable ag-header-cell-sorted-none"><table style="width:100%;height:100%"><tr><td><div id="agHeaderCellLabel" class="ag-header-cell-label"><span id="agText" class="ag-header-cell-text"></span></div></td></tr></table></div>'},cellClass:function(b){var c="";return b.data.symbol==a.mainSelected&&(c=a.mainSelected),j.getCellClassSummary(b,{sellSignal:""},c)}}];b.gridMarketOptions={enableSorting:!1,enableFilter:!1,rowData:[],data:[],headerHeight:50,enableColResize:!1,suppressNoRowsOverlay:!0,columnDefs:p},j.getMarketSummary().then(function(a){b.headerTitle=a})["catch"](function(a){});var q=e(f.child("summary_titles")),r=e(f.child("summary_headers")),s=e(f.child("summary_format"));q.$loaded(function(){r.$loaded(function(){s.$loaded(function(){var c=q.data.split("|"),d=r.data.split("|"),e=s.data.split("|"),h={},k={symbol:90,matchPrice:100,priceChange:100,totalValue:125,volumeChange:95,EPS:65,newPoint:75,Canslim:105,pricePeak:100,signal1:130,symbol2:75,signal2:130},m=[],p={idLabel:"Mã",labelList:[]},t=0;for(var u in c){h[d[u]]=e[u],p.labelList.push({fieldName:d[u],format:e[u]});var v=null,w=null;e[u].indexOf("bigNum")>-1||e[u].indexOf("number")>-1?(v="number",w="ui-cell-align-right"):w=e[u].indexOf("percent")>-1?"ui-cell-align-right":"ui-cell-align-left";var x={field:d[u],width:k[d[u]]||90,headerName:c[u],cellClass:w,enableTooltip:!0,tooltipField:d[u],cellRenderer:function(a){if("symbol2"==a.colDef.field)return""==a.data.signal1&&""==a.data.signal2?'<div data-symbol="'+a.data.symbol+'" title=""></div>':'<div class="chart-icon" data-symbol="'+a.data.symbol+'" title="'+a.value+'">'+a.value+"</div>";if("newPoint"==a.colDef.field||"EPS"==a.colDef.field){var b="";return b=isNaN(parseFloat(a.value))?n("number")(0,0):n("number")(parseFloat(a.value),0),'<div data-symbol="'+a.data.symbol+'" title="'+b+'">'+b+"</div>"}var b="";return h[a.colDef.field].indexOf("number")>-1||h[a.colDef.field].indexOf("bigNum")>-1||h[a.colDef.field].indexOf("percent")>-1?(b=n("number")(a.value),h[a.colDef.field].indexOf("percent")>-1&&(isNaN(parseFloat(a.value))?b="":(b=n("number")(a.value,2),b+="%")),'<div data-symbol="'+a.data.symbol+'" title="'+b+'">'+b+"</div>"):'<div data-symbol="'+a.data.symbol+'" title="'+a.value+'">'+a.value+"</div>"},headerCellTemplate:function(a){var b=a.column,c=b.colId,d="";("signal1"==c||"symbol2"==c||"signal2"==c)&&(d="ag-header-cell-green");var e='<td width="20px" style="vertical-align:top"><span id="agMenu" class="ag-header-icon ag-header-cell-menu-button" style="opacity: 0; transition: opacity 0.2s, border 0.2s;"><svg width="12" height="12"><rect y="0" width="12" height="2" class="ag-header-icon"></rect><rect y="5" width="12" height="2" class="ag-header-icon"></rect><rect y="10" width="12" height="2" class="ag-header-icon"></rect></svg></span></td>',f='<td width="20px"><div id="" class="ag-header-cell-label"><span id="agSortAsc" class="ag-header-icon ag-sort-ascending-icon ag-hidden"><svg width="10" height="10"><polygon points="0,10 5,0 10,10"></polygon></svg></span>    <span id="agSortDesc" class="ag-header-icon ag-sort-descending-icon ag-hidden"><svg width="10" height="10"><polygon points="0,0 5,10 10,0"></polygon></svg></span><span id="agNoSort" class="ag-header-icon ag-sort-none-icon ag-hidden"><svg width="10" height="10"><polygon points="0,4 5,0 10,4"></polygon><polygon points="0,6 5,10 10,6"></polygon></svg></span><span id="agFilter" class="ag-header-icon ag-filter-icon ag-hidden"><svg width="10" height="10"><polygon points="0,0 4,4 4,10 6,10 6,4 10,0" class="ag-header-icon"></polygon></svg></span></div></td>';return"sellSignal"==c&&(f="",e="",d="ag-header-cell-red"),'<div class="ag-header-cell '+d+' ag-header-cell-sortable ag-header-cell-sorted-none"><table style="width:100%;height:100%"><tr>'+e+'<td><div id="agHeaderCellLabel" class="ag-header-cell-label"><span id="agText" class="ag-header-cell-text"></span></div></td>'+f+"</tr></table></div>"}};"totalValue"===x.field&&(x.sort="desc"),t++,v&&(x.cellFilter=v),"symbol"==d[u]?(x.filter="text",x.pinned="left",x.cellRenderer=function(a){var b=a.value;return"<div><span>"+a.value+'</span><img class="chart-icon" data-symbol="'+b+'" data-industry = "'+a.node.data.industry+'" src="./images/icon-graph.png"><img class="information-icon" data-symbol="'+b+'" data-industry = "'+a.node.data.industry+'" src="./images/icon-information.png" /></div>'}):"sellSignal"==d[u]&&(x.suppressSorting=!0),x.cellClass=function(b){var c="";return b.data.symbol==a.mainSelected&&(c=a.mainSelected),j.getCellClassSummary(b,h,c)},m.push(x)}a.filters=m;var y,z=[],A=[];if(b.gridMainOptions.api){b.gridMainOptions.api.setColumnDefs(m);var B=document.querySelector("#grid-market-options");new agGrid.Grid(B,b.gridMarketOptions),g.drawGrid(f.child("summary_data"),p,function(a){b.gridMainOptions.api.showLoadingOverlay()},function(a){b.gridMainOptions.api.setRowData(a),b.gridMainOptions.api.addEventListener("afterSortChanged",function(a){var c=[];if(b.gridMainOptions.api&&null!=b.gridMainOptions.api){b.gridMainOptions.api.forEachNode(function(a){var b="";A[a.childIndex]&&(b=A[a.childIndex]),a.data.sellSignal=b,c.push(a)}),b.gridMainOptions.api.refreshCells(c,["sellSignal"]);var d=b.gridMainOptions.api.getSortModel();if(d)for(var e in d){var f=d[e].colId,g=d[e].sort,h=b.gridMainOptions.columnApi.getColumn(f),i=h.colDef.headerName;l.ga("send",{hitType:"event",eventCategory:"Tổng hợp - Sắp xếp dữ liệu",eventAction:"Xắp xếp",eventLabel:"Xắp xếp "+("desc"==g?"giảm dần":"tăng dần")+" theo "+i})}}})},{added:function(a,c,d){z.push(a),y||(y=o(function(){b.gridMainOptions.api&&null!=b.gridMainOptions.api&&(b.gridMainOptions.api.setRowData(z),j.getSellSignals().then(function(a){b.gridMarketOptions.api.setRowData(a);var c=$('div[ng-grid="gridMainOptions"]').find(".ag-body"),d=$('div[ng-grid="gridMainOptions"]').find(".ag-pinned-left-cols-container"),e=$("#grid-market-options").find(".ag-body-viewport"),f=d.height();f>=c.height()&&(f=c.height()),e.height(f),e.css("background","#F4CCCC")})["catch"](function(a){})),z=[],y=void 0},1e3))},changed:function(a,b,c){},removed:function(a){}})}$(document).ready(function(){$(document).on("click",".chart-icon",function(){$("#myModal").modal("show"),b.stockInfo=$(this).data("symbol"),b.iSrc="https://banggia.vndirect.com.vn/chart/?symbol="+$(this).data("symbol"),b.iSrcTrust=i.trustAsResourceUrl(b.iSrc)}),$(document).on("click",".information-icon",function(){$("#companyModal").modal("show");var a=$(this).data("symbol");$(this).data("industry");b.companyInfo=a,j.getCompanyInformation(a).then(function(a){b.companyDatas=a})["catch"](function(a){})})})})})})}]),angular.module("superstockApp").controller("FullStockCtrl",["$rootScope","$scope","auth","$firebaseArray","$firebaseObject","Ref","draw","uiGridConstants","$sce","utils","currentAuth","$window","$compile","$filter","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b,c){a.filterOn&&(void 0!=b&&(x=b),v?r():a.filterData&&null!=a.filterData?q(a.filterData):a.resetFilter())}function q(a){a&&(a=a[0]),x||(b.gridOptions.api&&null!=b.gridOptions.api&&b.gridOptions.api.showLoadingOverlay(),x=!0),o(function(){var c={};for(var d in a)a[d].condition&&a[d].term&&(c[d]={type:a[d].condition,filter:a[d].term});b.gridOptions.api&&(b.gridOptions.api.setFilterModel(c),b.gridOptions.api.onFilterChanged())},500)}function r(c,d){u++,u<=Object.keys(a.filterList).length||(x||(b.gridOptions.api&&null!=b.gridOptions.api&&b.gridOptions.api.showLoadingOverlay(),x=!0),o(function(){if(b.gridOptions.api&&null!=b.gridOptions.api){b.gridOptions.api.setFilterModel(null);for(var c in a.filterList){var d=a.filterList[c],e=b.gridOptions.api.getFilterApi(c);if(d.filter){var f=d.filter.term;if(f&&f.length>0){var g=[];for(var h in f)g.push(f[h].value);g.length>0?e.setModel(g):e.selectEverything&&e.selectEverything()}else e.selectEverything&&e.selectEverything()}else if(d.filters&&d.filters[0]){var i=b.gridOptions.api.getFilterApi(c);if((i.GREATER_THAN||d.filters[0].condition)&&(d.filters[0].term||0==d.filters[0].term)){var j=i.GREATER_THAN?i.GREATER_THAN:d.filters[0].condition;i.setType(j),i.setFilter(d.filters[0].term)}}}b.gridOptions.api.onFilterChanged()}},600),a.saveFilterSetting())}function s(){$(".ui-grid-header-cell").each(function(){var a=$(this),b=a.find("span");b.text().indexOf("\n")<0?(b.parent().css("line-height","40px"),a.css("text-align","center")):b.last().css("margin-top","-2px")})}a.link="full",l.ga("send","pageview","Đầy đủ");var t=null,u=0,v=!1;if(a.filterList={},k){var w=e(f.child("users/"+k.uid+"/filter"));a.filterRef=w,w.$loaded(function(a){if(t={},a.individualFilter)for(var b in a.individualFilter)"$"!=b.charAt(0)&&"forEach"!=b&&(t[b]=a[b])})}b.gridOptions={enableSorting:!0,enableFilter:!0,suppressColumnVirtualisation:!0,suppressContextMenu:!0,rowData:[],data:[],enableColResize:!0,headerHeight:50,overlayLoadingTemplate:'<span class="ag-overlay-loading-center">Đang xử lý dữ liệu...</span>',sortingOrder:["desc","asc"],onAfterFilterChanged:function(){},onCellClicked:function(a){}};var x=!1;a.filterModes=function(a){v=a,p(void 0)},a.parseBigNum=function(a){var b=parseFloat(a)/y;return b},a.resetFilter=function(){b.gridOptions.api&&null!=b.gridOptions.api&&b.gridOptions.api.showLoadingOverlay(),o(function(){b.gridOptions.api&&(b.gridOptions.api.setFilterModel(null),b.gridOptions.api.onFilterChanged())},600)},a.search=function(a){var c=b.gridOptions.api.getFilterApi("symbol");c.setType(c.CONTAINS||"contains"),c.setFilter(a),b.gridOptions.api.onFilterChanged()},b.rowAfterFilter=[],a.exportDatasheet=function(a){a.preventDefault(),$("#exportProccessing").modal("show"),o(function(){var a={};if(b.rowAfterFilter&&b.rowAfterFilter.length>0)for(var c in b.rowAfterFilter){var d=b.rowAfterFilter[c],e=d.data;a[d.childIndex]=e,a[d.childIndex]&&(a[d.childIndex].basicCustom="http://ivt.ssi.com.vn/CorporateProfile.aspx?Ticket="+a[d.childIndex].symbol,a[d.childIndex].chartCustom="https://banggia.vndirect.com.vn/chart/?symbol="+a[d.childIndex].symbol)}else{if(!b.gridOptions.api)return;b.gridOptions.api.forEachNode(function(b){var c=b.data;a[b.childIndex]=c,a[b.childIndex]&&(a[b.childIndex].basicCustom="http://ivt.ssi.com.vn/CorporateProfile.aspx?Ticket="+a[b.childIndex].symbol,a[b.childIndex].chartCustom="https://banggia.vndirect.com.vn/chart/?symbol="+a[b.childIndex].symbol)})}var f=A.data.split("|"),g=B.data.split("|"),h={},i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ"],k=0,l=3;for(var c in f){var m=c;"symbol"!=f[c]&&(m=l.toString());var n={cell:i[m],format:g[c]};"symbol2"==f[c]?(h[f[c]+k]=n,k++):h[f[c]]=n,"symbol"!=f[c]&&l++}j.writeData2Worksheet(a,h).then(function(a){j.generateWorksheetFile(a,function(){$("#exportProccessing").modal("hide")})})},500)};var y=1e9,z=e(f.child("superstock_titles")),A=e(f.child("superstock_fields")),B=e(f.child("superstock_format"));A.$loaded(function(){z.$loaded(function(){B.$loaded(function(){var c=z.data.split("|"),d=A.data.split("|"),e=B.data.split("|"),h={},i=[90,220,130,95,100,140,140,120,90,135,145,135,75,155,90,110,125,120,120,100,80,120,90,125,125,125,155,100,150,100,100,90,110,110,130,120,120,110,100,95,130,125,80,125],m=[],q={idLabel:"Mã",labelList:[]};for(var t in c){h[d[t]]=e[t],q.labelList.push({fieldName:d[t],format:e[t]});var u=null,w=null,x="text";e[t].indexOf("bigNum")>-1||e[t].indexOf("number")>-1?(u="number",x="number"):e[t].indexOf("percent")>-1&&(x="number");var C={field:d[t],width:i[t],headerName:c[t],cellClass:w,enableTooltip:!0,tooltipField:d[t],cellRenderer:function(a){if("symbol2"==a.colDef.field)return a.data.buySignal1||(a.data.buySignal1=""),a.data.buySignal2||(a.data.buySignal2=""),""==a.data.buySignal1&&""==a.data.buySignal2?'<div data-symbol="'+a.data.symbol+'" title=""></div>':'<div class="chart-icon" data-symbol="'+a.data.symbol+'" title="'+a.value+'" data-industry = "'+a.node.data.industry+'">'+a.value+"</div>";if("newPoint"==a.colDef.field||"EPS"==a.colDef.field||"fxEffect"==a.colDef.field||"cashFlow"==a.colDef.field){var b="";return b=isNaN(parseFloat(a.value))?n("number")(0,2):n("number")(parseFloat(a.value),2),'<div data-symbol="'+a.data.symbol+'" title="'+b+'">'+b+"</div>"}if("buyDate"==a.colDef.field);else{var b="";if(h[a.colDef.field].indexOf("number")>-1||h[a.colDef.field].indexOf("bigNum")>-1||h[a.colDef.field].indexOf("percent")>-1)return b=n("number")(a.value),h[a.colDef.field].indexOf("percent")>-1&&(isNaN(parseFloat(a.value))?b="":(b=n("number")(a.value,2),b+="%")),"maVol30"==a.colDef.field?(b=n("number")(a.value,0),0>b&&(b="")):"pe"==a.colDef.field&&(b=n("number")(a.value,2)),'<div data-symbol="'+a.data.symbol+'" title="'+b+'">'+b+"</div>"}if("pe"==a.colDef.field){var b=parseFloat(a.value);return isNaN(b)&&(b=0),b=n("number")(b,2),'<div data-symbol="'+a.data.symbol+'" title="'+b+'">'+b+"</div>"}return'<div data-symbol="'+a.data.symbol+'" title="'+a.value+'">'+a.value+"</div>"},headerCellTemplate:function(){return'<div class="ag-header-cell ag-header-cell-sortable ag-header-cell-sorted-none"><table style="width:100%;height:100%"><tr><td width="20px" style="vertical-align:top"><span id="agMenu" class="ag-header-icon ag-header-cell-menu-button" style="opacity: 0; transition: opacity 0.2s, border 0.2s;"><svg width="12" height="12"><rect y="0" width="12" height="2" class="ag-header-icon"></rect><rect y="5" width="12" height="2" class="ag-header-icon"></rect><rect y="10" width="12" height="2" class="ag-header-icon"></rect></svg></span></td><td><div id="agHeaderCellLabel" class="ag-header-cell-label"><span id="agText" class="ag-header-cell-text"></span></div></td><td width="20px"><div id="" class="ag-header-cell-label"><span id="agSortAsc" class="ag-header-icon ag-sort-ascending-icon ag-hidden"><svg width="10" height="10"><polygon points="0,10 5,0 10,10"></polygon></svg></span>    <span id="agSortDesc" class="ag-header-icon ag-sort-descending-icon ag-hidden"><svg width="10" height="10"><polygon points="0,0 5,10 10,0"></polygon></svg></span><span id="agNoSort" class="ag-header-icon ag-sort-none-icon ag-hidden"><svg width="10" height="10"><polygon points="0,4 5,0 10,4"></polygon><polygon points="0,6 5,10 10,6"></polygon></svg></span><span id="agFilter" class="ag-header-icon ag-filter-icon ag-hidden"><svg width="10" height="10"><polygon points="0,0 4,4 4,10 6,10 6,4 10,0" class="ag-header-icon"></polygon></svg></span></div></td></tr></table></div>'}};if(a.userSetting&&a.userSetting.sort&&a.userSetting.sort.full&&C.field==a.userSetting.sort.full.colId&&(C.sort=a.userSetting.sort.full.sort),a.userSetting&&a.userSetting.pinColumns&&a.userSetting.pinColumns.full){var D=a.userSetting.pinColumns.full.indexOf(C.field);D>-1&&(C.pinned="left")}if(a.userSetting&&a.userSetting.hiddenColumns&&a.userSetting.hiddenColumns.full){var D=a.userSetting.hiddenColumns.full.indexOf(C.field);D>-1&&(C.hide=!0)}if(u&&(C.cellFilter=u),x&&(C.filter=x),""!=e[t]){var E=e[t].split(":");if(4===E.length){var F=[{condition:"greaterThan",term:"bigNum"==E[0]?parseFloat(E[2])*y:parseFloat(E[2]),min:"bigNum"==E[0]?parseFloat(E[1])*y:parseFloat(E[1]),bigNum:"bigNum"==E[0]?!0:!1},{condition:"lessThan",term:1/0,max:"bigNum"==E[0]?parseFloat(E[3])*y:parseFloat(E[3])}];a.filterList[C.field]={headerName:C.headerName,filters:F}}}if("symbol"==d[t]&&(C.filter="text",C.pinned="left",C.cellRenderer=function(a){var b=a.value;return"<div><span>"+a.value+'</span><img class="chart-icon" data-symbol="'+b+'" data-industry = "'+a.node.data.industry+'" src="./images/icon-graph.png"><img class="information-icon" data-symbol="'+b+'" data-industry = "'+a.node.data.industry+'" src="./images/icon-information.png" /></div>'}),"shorttermSignal"==d[t]);else if("industry"==d[t]){C.filter="set";var x={term:null,selectOptions:[{value:"Bao bì & đóng gói",label:"Bao bì & đóng gói"},{value:"Công trình xây dựng",label:"Công trình xây dựng"},{value:"Dịch vụ đầu tư",label:"Dịch vụ đầu tư"},{value:"Đầu tư và phát triển BDS",label:"Đầu tư và phát triển BDS"},{value:"Đồ may mặc, trang sức, phụ kiện",label:"Đồ may mặc, trang sức, phụ kiện"},{value:"Dược phẩm",label:"Dược phẩm"},{value:"Gas",label:"Gas"},{value:"Nông sản và thủy hải sản",label:"Nông sản và thủy hải sản"},{value:"Ngân hàng",label:"Ngân hàng"},{value:"Thực phẩm",label:"Thực phẩm"},{value:"Thép",label:"Thép"},{value:"Vận tải biển",label:"Vận tải biển"}],typeSearch:"multiple"};a.filterList[C.field]={headerName:C.headerName,filter:x},C.minWidth=200}C.cellClass=function(b){var c="";return b.data.symbol==a.fullSelected&&(c=a.fullSelected),j.getCellClass(b,h,c)},m.push(C)}a.filters=m,a.setFilterSetting(),a.userFilter&&(a.userFilter.individualFilter&&(a.filterList=filterConvert(a.filterList,a.userFilter.individualFilter)),v=a.userFilter.filterMode);var G,H=[];b.gridOptions.api&&(b.gridOptions.api.setColumnDefs(m),b.gridOptions.api.showLoadingOverlay(),g.drawGrid(f.child("superstock"),q,function(a){},function(c){if(b.gridOptions.api){b.gridOptions.api.hideOverlay(),b.gridOptions.api.addEventListener("afterSortChanged",function(c){var d=a.userSetting;d||(d={sort:{full:{}},pinColumns:{}}),d.sort||(d.sort={full:{}}),d.sort.full||(d.sort.full={});var e=b.gridOptions.api.getSortModel();e&&e[0]&&(d.sort.full=e[0]);var g=f.child("users/"+k.uid);g.child("userSetting").set(d,function(a){a?console.log(a):console.log("Saved user setting")});var e=b.gridOptions.api.getSortModel();if(e)for(var h in e){var i=e[h].colId,j=e[h].sort,m=b.gridOptions.columnApi.getColumn(i),n=m.colDef.headerName;l.ga("send",{hitType:"event",eventCategory:"Đầy đủ - Sắp xếp dữ liệu",eventAction:"Sắp xếp",eventLabel:"Sắp xếp "+("desc"==j?"giảm dần":"tăng dần")+" theo "+n})}}),b.gridOptions.api.addEventListener("columnPinned",function(c){var d=a.userSetting;d||(d={sort:{full:{}},pinColumns:{full:{}}}),d.pinColumns||(d.pinColumns={full:[]}),d.pinColumns.full||(d.pinColumns.full=[]);var e=b.gridOptions.columnApi.getDisplayedLeftColumns();if(d.pinColumns.full=[],e)for(var g in e){var h=e[g].colId;d.pinColumns.full.push(h)}var i=f.child("users/"+k.uid);i.child("userSetting").set(d,function(a){a?console.log(a):console.log("Saved user setting")})}),b.gridOptions.api.addEventListener("beforeFilterChanged",function(a){}),b.gridOptions.api.addEventListener("afterFilterChanged",function(a){if(b.gridOptions.api.hideOverlay(),b.rowAfterFilter=b.gridOptions.api.rowModel.rowsToDisplay,v){var c=b.gridOptions.api.getFilterModel();for(var d in c){var e="",f=b.gridOptions.columnApi.getColumn(d);if(c[d]instanceof Array)e=f.colDef.headerName+" là "+c[d].join(" và ");else{var g=n("number")(c[d].filter);e=f.colDef.headerName+" có giá trị >= "+g}l.ga("send",{hitType:"event",eventCategory:"Bộ lọc",eventAction:"Bộ lọc cá nhân",eventLabel:e})}}}),b.gridOptions.api.addEventListener("columnVisible",function(c){var d=a.userSetting;d||(d={sort:{full:{}},pinColumns:{full:[]},hiddenColumns:{full:[]}}),d.hiddenColumns||(d.hiddenColumns={full:[]}),d.hiddenColumns.full||(d.hiddenColumns.full=[]);var e=b.gridOptions.columnApi.getAllColumns(),g=e.filter(function(a){return 0==a.visible}),h=[];if(g)for(var i in g)h.push(g[i].colId);d.hiddenColumns.full=h;var j=f.child("users/"+k.uid);j.child("userSetting").set(d,function(a){a?console.log(a):console.log("Saved user setting")})});for(var d in a.filterList)a.filterList[d].filters&&b.$watch('filterList["'+d+'"].filters[0].term',function(a,b){r(a,b)}),a.filterList[d].filter&&b.$watch('filterList["'+d+'"].filter.term',function(a,b){r(a,b)});setTimeout(function(){s()},1e3)}},{added:function(a,c,d){isNaN(a.disruptQtty)&&(a.disruptQtty=0),H.push(a),G||(G=o(function(){b.gridOptions.api&&null!=b.gridOptions.api&&b.gridOptions.api.setRowData(H),p(!1),H=[],G=void 0},1e3))},changed:function(a,b,c){},removed:function(a){}}))})})}),$(document).ready(function(){$(document).on("change",".subTerm",function(){$(this).each(function(){var c=$(this);c.prop("value",c.val());var d=c.data("model");b.$apply(function(){a.filterList[d].filters[0].term=parseFloat(c.val())*y,c.prop("value",c.val())}),c.parent().next().children().slider({slide:function(a,b){c.prop("value",b.value/y)}})})}),$(document).on("click",".chart-icon",function(){$("#myModal").modal("show"),b.stockInfo=$(this).data("symbol")+" - "+$(this).data("industry"),b.iSrc="https://banggia.vndirect.com.vn/chart/?symbol="+$(this).data("symbol"),b.iSrcTrust=i.trustAsResourceUrl(b.iSrc)}),$(document).on("click",".information-icon",function(){$("#companyModal").modal("show");var a=$(this).data("symbol"),c=$(this).data("industry");b.companyInfo=a+" - "+c,j.getCompanyInformation(a).then(function(a){b.companyDatas=a})["catch"](function(a){})})})}]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter);
}),b.preventDefault())})}}),angular.module("superstockApp").controller("MenuCtrl",["$rootScope","$scope","auth","$location","Ref","$firebaseObject","$timeout","$window",function(a,b,c,d,e,f,g,h){function i(){d.path("/")}function j(c,d){var g=c.toJSON();return new Promise(function(b,c){var d=f(e.child("users/"+g.uid));a.$userRef=d,d.$loaded(function(a){a?(g.account=a.account,b(g)):b()})}).then(function(f){return f||(f=c.toJSON()),new Promise(function(c,g){var h=e.child("users/"),i=f.uid,j={profile:{fullName:f.displayName,email:f.email},account:{registerdDate:firebase.database.ServerValue.TIMESTAMP,active:!0}};"password"==d&&(j.profile.fullName=b.userSignup.fullName,j.profile.phoneNumber=b.userSignup.phoneNumber),f.providerData&&f.providerData[0]&&(j.profile.email=f.providerData[0].email),f&&f.account&&(h=e.child("users/"+f.uid),i="profile",j=j.profile),h.child(i).set(j,function(d){d?g():(a.fullName=b.userSignup.fullName,c(j))})})})}function k(a){var b=a;if("facebook"==a){b=new firebase.auth.FacebookAuthProvider;for(var c in b)b[c]instanceof Array&&b[c].push("email")}return b}function l(a){var c=b.form,d=b.userSignin;"signup"==a?(c=b.form_signup,d=b.userSignup):"changePassword"==a?(c=b.form_change_pasword,d=b.userProfile):"changeProfile"==a&&(c=b.form_change_profile,d=b.userProfile);var e=!0;return"changePassword"==a||"changeProfile"==a||(!d||d.email)&&c.email.$valid?b.checkEmail=!0:(b.checkEmail=!1,e=!1),c.password&&d&&(!d.password||d.password.length<7)?(b.checkPassword=!1,e=!1):b.checkPassword=!0,c&&c.confirm_password&&(d.password==d.confirmPassword&&d.confirmPassword?b.checkConfirmPassword=!0:(b.checkConfirmPassword=!1,e=!1)),c&&c.full_name&&(d&&!d.fullName?(b.checkFullName=!1,e=!1):b.checkFullName=!0),c&&c.new_password&&(!d.newPassword||d.newPassword.length<7?(b.checkNewPassword=!1,e=!1):b.checkNewPassword=!0),c&&c.confirm_new_password&&(d.newPassword==d.confirmNewPassword&&d.confirmNewPassword?b.checkConfirmNewPassword=!0:(b.checkConfirmNewPassword=!1,e=!1)),c&&c.phone_number&&(d.phoneNumber?b.checkPhoneNumber=!0:(b.checkPhoneNumber=!1,e=!1)),e}a.link="";b.filterShow=function(b){b.preventDefault(),b.stopPropagation(),"main"!=a.link&&($("#wrapper").toggleClass("toggled"),$("#wrapper").hasClass("toggled")?(a.filterOn=!0,$(".item-to-hide").removeClass("hidden")):(a.filterOn=!0,a.filterChangeGlobal(),a.setDataForDefaultFilter(),$("#js-navbar-collapse").find("ul > li").removeClass("active"),$("#filter-control").addClass("active"),$(".item-to-hide").addClass("hidden")))},b.userSignin={},b.userSignup={},b.userProfile={},b.checkEmail,b.checkPassword,b.checkSignIn=!0,b.checkConfirmPassword,b.checkFullName,b.checkNewPassword,b.checkConfirmNewPassword,b.disabledButton,b.loading=!1,b.oauthLogin=function(a){h.ga("send",{hitType:"event",eventCategory:"Đăng nhập tài khoản",eventAction:"Đăng nhập",eventLabel:""});var d=k(a);if("facebook"==a)c.$signInWithPopup(d).then(function(a){return j(a.user)}).then(function(a){$("#signInModal").modal("hide"),i()})["catch"](function(a){console.log("login error"),console.log(a)});else{if(!l())return void(b.checkSignIn=!0);b.disabledButton=!0,b.loading=!0,b.checkSignIn=!0,c.$signInWithEmailAndPassword(b.userSignin.email,b.userSignin.password).then(function(a){$("#signInModal").modal("hide"),b.disabledButton=!1,b.loading=!1,i()})["catch"](function(a){b.disabledButton=!1,b.loading=!1,a.code&&(b.checkSignIn=!1)})}},b.oauthSignUp=function(){b.checkSignUpMessage="",l("signup")&&(h.ga("send",{hitType:"event",eventCategory:"Đăng ký tài khoản",eventAction:"Đăng ký",eventLabel:""}),b.disabledButton=!0,b.loading=!0,c.$createUserWithEmailAndPassword(b.userSignup.email,b.userSignup.password).then(function(c){return a.userTmp={email:b.userSignup.email,displayName:b.userSignup.fullName,phoneNumber:b.userSignup.phoneNumber},j(c,"password")}).then(function(a){$("#signUpModal").modal("hide"),b.disabledButton=!1,b.loading=!1,i()})["catch"](function(a){b.disabledButton=!1,b.loading=!1,a.code&&(b.checkSignUp=!1,"auth/email-already-in-use"==a.code?b.checkSignUpMessage="Email đã được sử dụng bởi người dùng khác.":b.checkSignUpMessage=a.message)}))},b.logout=function(){c.$signOut(),a.$userRef&&a.$userRef.$destroy(),d.path("/")},a.openGuideModal=function(a){a.preventDefault(),$("#superStockGuideModal").modal("show")},a.activeDeactiveAccount=function(b,c){c.preventDefault();var d,g=new Promise(function(a,c){var g=f(e.child("users/"+b));d=g,g.$loaded(function(b){b&&b.account?a(b):c()})});g.then(function(c){return new Promise(function(d,f){var g=e.child("users/"+b),h={active:!0};if(c.account.active&&(h.active=!1),h.active){var i=new Date;i.setDate(i.getUTCDate()+1),h.expired_date=i.getFullYear()+"-"+(i.getUTCMonth()+1)+"-"+i.getUTCDate()}else h.expired_date="";g.child("account").set(h,function(b){b?f():(a.user.account.active=h.active,h.expired_date&&(a.user.account.expired_date=new Date(h.expired_date)),d())})})}).then(function(){$(c.target).parent().addClass("hidden"),d&&d.$destroy()})["catch"](function(a){$(c.target).parent().addClass("hidden"),d&&d.$destroy()})},b.signInForm=function(){b.checkEmail=!0,b.checkPassword=!0,b.checkSignIn=!0,b.checkConfirmPassword=!0,b.checkFullName=!0,b.loading=!1,b.userSignin={},$("#signInModal").modal("show")},b.signUpForm=function(){b.checkEmail=!0,b.checkPassword=!0,b.checkSignUp=!0,b.checkConfirmPassword=!0,b.checkFullName=!0,b.checkPhoneNumber=!0,b.loading=!1,b.userSignup={},$("#signUpModal").modal("show")},b.changePasswordForm=function(){b.checkEmail=!0,b.checkPassword=!0,b.checkSignIn=!0,b.checkConfirmPassword=!0,b.checkFullName=!0,b.checkPhoneNumber=!0,b.loading=!1,b.userSignup={},$("#changePasswordModal").modal("show")},b.changeProfileForm=function(){$("#changeProfileModal").modal("show")},b.checkChangePassword=!0,b.changePassword=function(){return l("changePassword")?(b.loading=!0,void c.$updatePassword(b.userProfile.newPassword).then(function(a){$("#changePasswordModal").modal("hide"),b.disabledButton=!1,b.loading=!1})["catch"](function(a){b.disabledButton=!1,b.loading=!1,a.code&&(b.checkChangePassword=!1)})):void(b.checkChangePassword=!0)},b.checkChangeProfile=!0,b.changeProfile=function(){if(!l("changeProfile"))return void(b.checkChangeProfile=!0);if(a.user){var c=a.user.profile;c.fullName=b.userProfile.fullName,c.phoneNumber=b.userProfile.phoneNumber,b.loading=!0,b.disabledButton=!0;var d=e.child("users/"+a.user.uid);d.child("profile").set(c,function(c){b.$apply(function(){c?b.checkChangeProfile=!1:(b.checkChangeProfile=!0,a.user.displayName=b.userProfile.fullName,a.user.phoneNumber=b.userProfile.phoneNumber),$("#changeProfileModal").modal("hide"),b.disabledButton=!1,b.loading=!1})})}},$(document).on("hidden.bs.modal",".modal",function(){$(this);b.$apply(function(){b.checkEmail=!0,b.checkPassword=!0,b.checkSignIn=!0,b.checkConfirmPassword=!0,b.checkFullName=!0,b.checkNewPassword=!0,b.checkConfirmNewPassword=!0})}),$(document).on("hidden.bs.modal",".modal",function(){var a=$(this),c=a.find("input");$.each(c,function(a,b){$(b).attr("name")&&$(b).val("")}),b.$apply(function(){b.checkEmail=!0,b.checkPassword=!0,b.checkSignIn=!0,b.checkSignUp=!0,b.checkConfirmPassword=!0,b.checkFullName=!0,b.checkNewPassword=!0,b.checkConfirmNewPassword=!0,b.userSignin={},b.userSignup={},b.userProfile={}})}),$(document).on("shown.bs.modal","#changeProfileModal",function(){b.$apply(function(){a.user&&(b.userProfile.fullName=a.user.displayName,b.userProfile.phoneNumber=a.user.phoneNumber)})}),$(document).on("mouseenter",".ag-cell",function(){var a=$(this),b=a.parent(),c=b.find(".ag-cell");c.addClass("ag-cell-hover-bg")}),$(document).on("mouseleave",".ag-cell",function(){var a=$(this),b=a.parent(),c=b.find(".ag-cell");c.removeClass("ag-cell-hover-bg")}),a.mainSelected="",a.fullSelected="",$(document).on("click",".ag-cell",function(){var b=$(this),c=b.find("div").first().data("symbol");"main"==a.link?a.mainSelected=c:a.fullSelected=c;var d=$(".ag-row.clicked"),e=b.parent(),f=e.find(".ag-cell");d.find(".ag-cell").removeClass("ag-cell-focus-bg"),e.addClass("clicked"),f.addClass("ag-cell-focus-bg")})}]),angular.module("superstockApp").controller("FilterCtrl",["$rootScope","$scope","Ref","$firebaseArray","$compile","$window",function(a,b,c,d,e,f){b.defaultFilter=[{id:1,EPS:{term:1e3,condition:"greaterThan"},maVol30:{term:3e4,condition:"greaterThan"},point:{term:7,condition:"greaterThan"},profitChange:{term:20,condition:"greaterThan"},roe:{term:7,condition:"greaterThan"},filterName:"Cơ bản tốt"},{id:2,canslim:{term:"Canslim",condition:"contains"},maVol30:{term:3e4,condition:"greaterThanOrEqual"},filterName:"Canslim"},{id:3,totalValue:{term:5e9,condition:"greaterThanOrEqual"},priceChange:{term:1,condition:"greaterThanOrEqual"},EPS:{term:3e3,condition:"greaterThanOrEqual"},point:{term:7,condition:"greaterThanOrEqual"},filterName:"Siêu cổ phiếu"},{id:4,capital:{term:1e4,condition:"greaterThanOrEqual"},filterName:"Vốn hóa lớn"},{id:5,sideway:{term:"sideway",condition:"contains"},maVol30:{term:3e4,condition:"greaterThanOrEqual"},filterName:"Các mã sideway"},{id:6,totalValue:{term:3e9,condition:"greaterThanOrEqual"},pricePeak:{term:"Cao nhất 30 phiên",condition:"contains"},filterName:"Vượt đỉnh"},{id:7,totalValue:{term:2e9,condition:"greaterThanOrEqual"},disruptQtty:{term:30,condition:"greaterThanOrEqual"},maVol30:{term:2e4,condition:"greaterThanOrEqual"},filterName:"Đột biến KL"},{id:8,totalValue:{term:2e9,condition:"greaterThanOrEqual"},maVol30:{term:2e4,condition:"greaterThanOrEqual"},priceChange:{term:1,condition:"greaterThanOrEqual"},shorttermSignal:{term:"xMua nếu cơ bản tốt",condition:"contains"},filterName:"Điểm mua ngắn hạn"}],b.individualFilter=!1,b.publicFilter=!0,b.filterModes,a.$watch("searchTerm",function(){a.search&&a.search(a.searchTerm)}),b.filterChange=function(){b.filter&&0==b.filter.length&&(b.filter=null),a.filterData=b.filter,a.filterModes&&a.filterModes(b.filterModes),a.saveFilterSetting(),!b.filterModes&&a.filterData&&a.filterData.length>0&&f.ga("send",{hitType:"event",eventCategory:"Bộ lọc",eventAction:"Bộ loc có sẵn",eventLabel:"Lọc theo "+a.filterData[0].filterName})},a.filterChangeGlobal=function(){b.filterChange()},b.$watch("filterModes",function(){a.filterModes&&(b.filterModes?(b.publicFilter=!1,b.individualFilter=!0,a.filterModes(!0)):(b.publicFilter=!0,b.individualFilter=!1,a.filterModes(!1)),a.saveFilterSetting())}),a.resetFilterModes=function(){b.filterModes=!1,b.publicFilter=!0,b.individualFilter=!1},$(document).on("click","#container-fluit-area, #footer-area, #header-area",function(c){$("#sidebar-wrapper").parent().hasClass("toggled")||($("#filter-control").removeClass("ng-hide"),$("#wrapper").toggleClass("toggled"),b.filter||b.filterModes||(a.filterOn=!1),a.filterOn||($("#js-navbar-collapse").find("ul > li").removeClass("active"),$("#full-stock").addClass("active")),$(".item-to-hide").removeClass("hidden"),b.$apply(function(){}))}),$(document).on("click","#full-stock",function(b){b.preventDefault(),"full"==a.link&&($("#js-navbar-collapse").find("ul > li").removeClass("active"),$(this).addClass("active"),a.resetFilterModes(),a.resetFilter()),a.filterOn=!1}),a.setDataForDefaultFilter=function(){},a.saveFilterSetting=function(){var d={};a.userFilter&&(d=a.userFilter,d.filterMode||d.publicFilter||d.individualFilter||(d={})),d.filterMode=b.filterModes;var e=[];if(b.filter&&null!=b.filter)for(var f in b.filter)e.push(b.filter[f].id);e&&(d.publicFilter=e);var g=filterConvert(a.filterList,null);g&&Object.keys(a.filterList).length>0&&(d.individualFilter=g);var h=c.child("users/"+a.user.uid);h.child("filter").set(d,function(a){a?console.log(a):console.log("Saved filter setting")})},a.setFilterSetting=function(){if(a.userFilter&&void 0!=a.userFilter.filterMode&&(b.filterModes=a.userFilter.filterMode,a.userFilter.publicFilter)){var c=[];for(var d in a.userFilter.publicFilter){var e=a.userFilter.publicFilter[d],f=b.defaultFilter.filter(function(a){return e==a.id});f&&f[0]&&c.push(f[0])}c&&c.length>0&&(b.filter=c)}}}]),angular.module("superstockApp").directive("ngShowAuth",["auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuthStateChanged(e),e()}}}]),angular.module("superstockApp").directive("ngHideAuth",["auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuthStateChanged(e),e()}}}]),angular.module("superstockApp").directive("categoryHeader",function(){function a(a){console.log(a.gridOptions.columnDefs),a.headerRowHeight=30,a.catHeaderRowHeight=a.headerRowHeight+"px",a.categories=[];var b="",c=0,d=0;cols=a.gridOptions.columnDefs;for(var e=0;e<cols.length;e++){c+=Number(cols[e].width);var f="undefined"==typeof cols[e].categoryDisplayName?" ":cols[e].categoryDisplayName;f!==b&&(a.categories.push({displayName:b,width:c-Number(cols[e].width),widthPx:c-Number(cols[e].width)+"px",left:d,leftPx:d+"px"}),d+=c-Number(cols[e].width),c=Number(cols[e].width),b=f)}c>0&&a.categories.push({displayName:b,width:c,widthPx:c+"px",left:d,leftPx:d+"px"})}return{templateUrl:"scripts/directives/templates/category_header.html",link:a}}),angular.module("superstockApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).when("/full",{templateUrl:"views/full-stock.html",controller:"FullStockCtrl",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl",resolve:{currentAuth:["auth",function(a){return a.$requireSignIn()}]}}).when("/chat",{templateUrl:"views/chat.html",controller:"Chat",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","loginRedirectPath","auth","$firebaseObject","Ref",function(a,b,c,d,e,f,g,h,i,j){d.$onAuthStateChanged(function(b){if(a.user=b?b.toJSON():void 0,a.userTmp&&a.user&&(a.user.displayName=a.userTmp.displayName,a.user.phoneNumber=a.userTmp.phoneNumber),a.user&&null!=a.user){var c=f.child("users/"+a.user.uid);a.$userRefChange=e(c),a.$userRefChange.$loaded(function(c){if(a.user){var d=!1;a.userSetting=c.userSetting,a.userFilter=c.filter,a.user.profile=c.profile,c.account?(a.user.account=c.account,b&&c&&c.profile&&(a.user.displayName=c.profile.fullName?c.profile.fullName:a.user.displayName,a.user.phoneNumber=c.profile.phoneNumber),a.fullName&&(a.user.displayName=a.fullName),a.user.account.expiredDate&&(a.user.account.expiredDate=new Date(a.user.account.expiredDate)),1!=a.user.account.active&&(a.user.account.active=!1)):a.user.account={active:!1},d=!a.user.account.active,d&&$("#expiredMessageModal").modal("show")}})}else a.$userRefChange&&a.$userRefChange.$destroy(),a.filterRef&&a.filterRef.$destroy(),a.$userRef&&a.$userRef.$destroy();a.showUI=!0}),a.$on("$routeChangeError",function(a,d,e,f){"AUTH_REQUIRED"===f&&b.path(c)})}]);